<div class="container">
  <h2>Gerenciamento de Contratos</h2>
  
  <div class="tabs">
    <button 
      [class.active]="activeTab === 'existente'" 
      (click)="activeTab = 'existente'">
      Inquilino Existente
    </button>
    <button 
      [class.active]="activeTab === 'novo'" 
      (click)="activeTab = 'novo'">
      Novo Inquilino
    </button>
  </div>
  
  <div class="loading-indicator" *ngIf="loading">
    <span>Carregando...</span>
  </div>
  
  <!-- Formulário de Inquilino Existente -->
  <div *ngIf="activeTab === 'existente'">
    <div class="form-section">
      <h3>Selecionar Inquilino</h3>
      
      <div class="form-field">
        <label for="tenant-select">Inquilino:</label>
        <!-- Fixed: Removed 'as FormControl' that was causing the error -->
        <select [formControl]="contractForm.controls.titularId">
          <option [ngValue]="null">Selecione um inquilino</option>
          <option *ngFor="let tenant of tenants" [ngValue]="tenant.id">
            {{ tenant.nome }}
          </option>
        </select>
        <div class="error-message" *ngIf="contractForm.controls.titularId.touched && contractForm.controls.titularId.errors?.['required']">
          Por favor, selecione um inquilino
        </div>
      </div>
    </div>
  </div>
  
  <!-- Formulário de Novo Inquilino -->
  <div *ngIf="activeTab === 'novo'">
    <div class="form-section">
      <h3>Cadastrar Novo Inquilino</h3>
      
      <form [formGroup]="newTenantForm" (ngSubmit)="createTenant()">
        <div class="form-row">
          <div class="form-field">
            <label for="nome">Nome:</label>
            <input type="text" id="nome" formControlName="nome">
            <div class="error-message" *ngIf="newTenantForm.controls.nome.touched && newTenantForm.controls.nome.errors?.['required']">
              Nome é obrigatório
            </div>
          </div>
          
          <div class="form-field">
            <label for="sobrenome">Sobrenome:</label>
            <input type="text" id="sobrenome" formControlName="sobrenome">
            <div class="error-message" *ngIf="newTenantForm.controls.sobrenome.touched && newTenantForm.controls.sobrenome.errors?.['required']">
              Sobrenome é obrigatório
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-field">
            <label for="email">Email:</label>
            <input type="email" id="email" formControlName="email">
            <div class="error-message" *ngIf="newTenantForm.controls.email.touched && newTenantForm.controls.email.errors?.['required']">
              Email é obrigatório
            </div>
            <div class="error-message" *ngIf="newTenantForm.controls.email.touched && newTenantForm.controls.email.errors?.['email']">
              Email inválido
            </div>
          </div>
          
          <div class="form-field">
            <label for="telefone">Telefone:</label>
            <input type="tel" id="telefone" formControlName="telefone">
            <div class="error-message" *ngIf="newTenantForm.controls.telefone.touched && newTenantForm.controls.telefone.errors?.['required']">
              Telefone é obrigatório
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-field">
            <label for="cpf">CPF:</label>
            <input type="text" id="cpf" formControlName="cpf">
            <div class="error-message" *ngIf="newTenantForm.controls.cpf.touched && newTenantForm.controls.cpf.errors?.['required']">
              CPF é obrigatório
            </div>
          </div>
          
          <div class="form-field">
            <label for="rg">RG:</label>
            <input type="text" id="rg" formControlName="rg">
            <div class="error-message" *ngIf="newTenantForm.controls.rg.touched && newTenantForm.controls.rg.errors?.['required']">
              RG é obrigatório
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-field">
            <label for="profissao">Profissão:</label>
            <input type="text" id="profissao" formControlName="profissao">
            <div class="error-message" *ngIf="newTenantForm.controls.profissao.touched && newTenantForm.controls.profissao.errors?.['required']">
              Profissão é obrigatória
            </div>
          </div>
          
          <div class="form-field">
            <label for="nascimento">Data de Nascimento:</label>
            <input type="date" id="nascimento" formControlName="nascimento">
            <div class="error-message" *ngIf="newTenantForm.controls.nascimento.touched && newTenantForm.controls.nascimento.errors?.['required']">
              Data de nascimento é obrigatória
            </div>
          </div>
        </div>
        
        <div class="button-container">
          <button type="submit" [disabled]="newTenantForm.invalid || loading">
            Cadastrar Inquilino
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Formulário de Contrato -->
  <div class="form-section" *ngIf="contractForm.controls.titularId.value || activeTab === 'existente'">
    <h3>Dados do Contrato</h3>
    
    <form [formGroup]="contractForm" (ngSubmit)="submitContract()">
      <div class="form-row">
        <div class="form-field">
          <label for="apnum">Número do Apartamento:</label>
          <input type="number" id="apnum" formControlName="apnum" min="1">
          <div class="error-message" *ngIf="contractForm.controls.apnum.touched && contractForm.controls.apnum.errors?.['required']">
            Número do apartamento é obrigatório
          </div>
          <div class="error-message" *ngIf="contractForm.controls.apnum.touched && contractForm.controls.apnum.errors?.['min']">
            Número do apartamento deve ser maior que 0
          </div>
        </div>
        
        <div class="form-field">
          <label for="referente">Ano de Referência:</label>
          <input type="number" id="referente" formControlName="referente">
          <div class="error-message" *ngIf="contractForm.controls.referente.touched && contractForm.controls.referente.errors?.['required']">
            Ano de referência é obrigatório
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field">
          <label for="valorAluguel">Valor do Aluguel (R$):</label>
          <input type="number" id="valorAluguel" formControlName="valorAluguel" step="0.01">
          <div class="error-message" *ngIf="contractForm.controls.valorAluguel.touched && contractForm.controls.valorAluguel.errors?.['required']">
            Valor do aluguel é obrigatório
          </div>
        </div>
        
        <div class="form-field">
          <label for="valorCondominio">Valor do Condomínio (R$):</label>
          <input type="number" id="valorCondominio" formControlName="valorCondominio" step="0.01">
          <div class="error-message" *ngIf="contractForm.controls.valorCondominio.touched && contractForm.controls.valorCondominio.errors?.['required']">
            Valor do condomínio é obrigatório
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field">
          <label for="valorIptu">Valor do IPTU (R$):</label>
          <input type="number" id="valorIptu" formControlName="valorIptu" step="0.01">
          <div class="error-message" *ngIf="contractForm.controls.valorIptu.touched && contractForm.controls.valorIptu.errors?.['required']">
            Valor do IPTU é obrigatório
          </div>
        </div>
        
        <div class="form-field">
          <label for="valorInternet">Valor da Internet (R$):</label>
          <input type="number" id="valorInternet" formControlName="valorInternet" step="0.01">
          <div class="error-message" *ngIf="contractForm.controls.valorInternet.touched && contractForm.controls.valorInternet.errors?.['required']">
            Valor da internet é obrigatório
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field">
          <label for="entrada">Data de Entrada:</label>
          <input type="date" id="entrada" formControlName="entrada">
          <div class="error-message" *ngIf="contractForm.controls.entrada.touched && contractForm.controls.entrada.errors?.['required']">
            Data de entrada é obrigatória
          </div>
        </div>
        
        <div class="form-field">
          <label for="dataAceite">Data de Aceite:</label>
          <input type="date" id="dataAceite" formControlName="dataAceite">
          <div class="error-message" *ngIf="contractForm.controls.dataAceite.touched && contractForm.controls.dataAceite.errors?.['required']">
            Data de aceite é obrigatória
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field">
          <label for="processo">Número do Processo:</label>
          <input type="text" id="processo" formControlName="processo">
          <div class="error-message" *ngIf="contractForm.controls.processo.touched && contractForm.controls.processo.errors?.['required']">
            Número do processo é obrigatório
          </div>
        </div>
        
        <div class="form-field">
          <label for="status">Status:</label>
          <select id="status" formControlName="status">
            <option value="DEFERIDO">DEFERIDO</option>
            <option value="INDEFERIDO">INDEFERIDO</option>
            <option value="EM_ANALISE">EM ANÁLISE</option>
          </select>
          <div class="error-message" *ngIf="contractForm.controls.status.touched && contractForm.controls.status.errors?.['required']">
            Status é obrigatório
          </div>
        </div>
      </div>
      
      <div class="button-container">
        <button type="submit" [disabled]="contractForm.invalid || loading">
          Criar Contrato
        </button>
      </div>
    </form>
  </div>
</div>